#include <CGAL/Exact_predicates_exact_constructions_kernel.h>
#include <CGAL/Arr_segment_traits_2.h>
#include <CGAL/Arrangement_on_surface_with_history_2.h>
#include <CGAL/Arrangement_with_history_2.h>
#include <CGAL/Arr_linear_traits_2.h>
#include <CGAL/Constrained_Delaunay_triangulation_2.h>
#include <CGAL/draw_triangulation_2.h>

#include <CGAL/Point_2.h>
#include <CGAL/Segment_2.h>

typedef CGAL::Exact_predicates_tag                                              Itag;

typedef CGAL::Exact_predicates_exact_constructions_kernel             K_1;
typedef CGAL::Arr_segment_traits_2<K_1>                Traits_2;
typedef Traits_2::Point_2                                 Point_2;
typedef Traits_2::Curve_2                                 Segment_2;
typedef CGAL::Arrangement_with_history_2<Traits_2>        Arr_with_hist_2;

typedef CGAL::Constrained_Delaunay_triangulation_2<K_1, CGAL::Default, Itag>     CDT_2;

int main()
{
    ExternalDataSet datas("data1.txt","data2.txt");
    
    Arr_with_hist_2 arr;

    // first step of insertions
    std::chrono::steady_clock::time_point begin = std::chrono::steady_clock::now();

    std::vector<Segment_2> segmentSet1 = datas.externalData(0);
    std::vector<Segment_2> segmentSet2 = datas.externalData(1);
    std::vector<Segment_2> segments=segmentSet1; 
    segments.insert(segments.end(),segmentSet2.begin(),segmentSet2.begin());
    CGAL::insert(arr, segments.begin(), segments.end());
    segmentSet1.clear();

    std::chrono::steady_clock::time_point end = std::chrono::steady_clock::now();
    if (verbose) std::cout << "Time spent - First Insertion: " << std::setprecision(6) << std::chrono::duration_cast<std::chrono::microseconds>(end - begin).count()/1.0e+6 << std::fixed << " sec." << std::endl;  
    
    
    CDT2 cdt;
    // Constrained Delaunay package to triangulate the arrangement
    begin = std::chrono::steady_clock::now();
    for (auto it = arr.edges_begin(); it != arr.edges_end(); ++it) {
        cdt.insert(it->source()->point(), it->target()->point());
    }
    end = std::chrono::steady_clock::now();
    if (verbose) std::cout << "Time spent - Creation of the Constrained Delaunay Triangulation: " << std::setprecision(6) << std::chrono::duration_cast<std::chrono::microseconds>(end - begin).count()/1.0e+6 << std::fixed << " sec." << std::endl;  
}